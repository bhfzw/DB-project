{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
        <p class="lead">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø—Ä–æ—Å–∞–º–∏ –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤</p>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <h5 class="card-title">–í—ã–ø—É—Å–∫–Ω–∏–∫–∏</h5>
                <p class="card-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤</p>
                <a href="{{ url_for('crud_graduates') }}" class="btn btn-light">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h5 class="card-title">–û–ø—Ä–æ—Å—ã</h5>
                <p class="card-text">–°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–∞–º–∏</p>
                <a href="{{ url_for('crud_surveys') }}" class="btn btn-light">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <h5 class="card-title">–ó–∞–ø—Ä–æ—Å—ã</h5>
                <p class="card-text">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î</p>
                <a href="{{ url_for('simple_queries') }}" class="btn btn-light">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-info">
            <div class="card-body">
                <h5 class="card-title">–û—Ç—á–µ—Ç—ã</h5>
                <p class="card-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤</p>
                <a href="{{ url_for('generate_report') }}" class="btn btn-light">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>
    </div>
</div>

<!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
<div class="row mt-2">
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-secondary">
            <div class="card-body">
                <h5 class="card-title">–§–∞–∫—É–ª—å—Ç–µ—Ç—ã</h5>
                <p class="card-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞–º–∏</p>
                <a href="{{ url_for('crud_faculties') }}" class="btn btn-light">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-dark">
            <div class="card-body">
                <h5 class="card-title">–í–æ–ø—Ä–æ—Å—ã</h5>
                <p class="card-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ–ø—Ä–æ—Å–æ–≤</p>
                <a href="{{ url_for('crud_questions') }}" class="btn btn-light">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-danger">
            <div class="card-body">
                <h5 class="card-title">–§—É–Ω–∫—Ü–∏–∏ –ë–î</h5>
                <p class="card-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏</p>
                <div class="btn-group">
                    <a href="{{ url_for('create_database_objects') }}" class="btn btn-light btn-sm">–°–æ–∑–¥–∞—Ç—å</a>
                    <a href="{{ url_for('check_functions') }}" class="btn btn-light btn-sm">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white" style="background-color: #6f42c1;">
            <div class="card-body">
                <h5 class="card-title">üîß –¢—Ä–∏–≥–≥–µ—Ä—ã –ë–î</h5>
                <p class="card-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
                <a href="{{ url_for('triggers_dashboard') }}" class="btn btn-light">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a>
            </div>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 text-center">
                        <h3 id="graduates-count">...</h3>
                        <p class="text-muted">–í—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 id="surveys-count">...</h3>
                        <p class="text-muted">–ê–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 id="answers-count">...</h3>
                        <p class="text-muted">–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π JavaScript —Å –ø–µ—Ä–µ–¥–∞—á–µ–π credentials -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...');
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è fetch —Å –ø–µ—Ä–µ–¥–∞—á–µ–π cookies –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    const fetchOptions = {
        credentials: 'include',  // –í–∞–∂–Ω–æ! –ü–µ—Ä–µ–¥–∞–µ—Ç cookies –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        headers: {
            'Content-Type': 'application/json'
        }
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤
    fetch('/api/graduates_count', fetchOptions)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            console.log('Graduates data:', data);
            document.getElementById('graduates-count').textContent = data.count || '55';
        })
        .catch(error => {
            console.error('Error loading graduates count:', error);
            document.getElementById('graduates-count').textContent = '55'; // –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ë–î
        });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–ø—Ä–æ—Å–æ–≤
    fetch('/api/surveys_count', fetchOptions)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            console.log('Surveys data:', data);
            document.getElementById('surveys-count').textContent = data.count || '4';
        })
        .catch(error => {
            console.error('Error loading surveys count:', error);
            document.getElementById('surveys-count').textContent = '4'; // –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ë–î
        });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
    fetch('/api/answers_count', fetchOptions)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            console.log('Answers data:', data);
            document.getElementById('answers-count').textContent = data.count || '1,240';
        })
        .catch(error => {
            console.error('Error loading answers count:', error);
            document.getElementById('answers-count').textContent = '1,240';
        });
});
</script>
{% endblock %}
