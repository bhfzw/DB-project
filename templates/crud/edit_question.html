{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <h2>Редактирование вопроса</h2>
            
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label class="form-label">Раздел</label>
                            <select class="form-select" name="section_id" required>
                                {% for section in sections %}
                                <option value="{{ section.section_id }}" {% if section.section_id == question.section_id %}selected{% endif %}>
                                    {{ section.title }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Текст вопроса</label>
                            <textarea class="form-control" name="question_text" rows="3" required>{{ question.question_text }}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Тип вопроса</label>
                            <select class="form-select" name="question_type" id="questionType" required>
                                <option value="text" {% if question.question_type == 'text' %}selected{% endif %}>Текстовый ответ</option>
                                <option value="single_choice" {% if question.question_type == 'single_choice' %}selected{% endif %}>Один вариант ответа</option>
                                <option value="multiple_choice" {% if question.question_type == 'multiple_choice' %}selected{% endif %}>Несколько вариантов ответа</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_required" id="isRequired" {% if question.is_required %}checked{% endif %}>
                                <label class="form-check-label" for="isRequired">
                                    Обязательный вопрос
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3" id="choicesSection" style="display: {% if question.question_type in ['single_choice', 'multiple_choice'] %}block{% else %}none{% endif %};">
                            <label class="form-label">Варианты ответов</label>
                            <div id="choicesContainer">
                                {% if question.choices %}
                                    {% for choice in question.choices %}
                                    <div class="input-group mb-2">
                                        <input type="text" class="form-control" name="choices[]" value="{{ choice.choice_text }}" placeholder="Введите вариант ответа">
                                        <button type="button" class="btn btn-outline-danger" onclick="removeChoice(this)">×</button>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="input-group mb-2">
                                        <input type="text" class="form-control" name="choices[]" placeholder="Введите вариант ответа">
                                        <button type="button" class="btn btn-outline-danger" onclick="removeChoice(this)">×</button>
                                    </div>
                                {% endif %}
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addChoice()">+ Добавить вариант</button>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                            <a href="{{ url_for('view_survey', id=section_info.survey_id) }}" class="btn btn-secondary">Отмена</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Показываем/скрываем поле вариантов ответов в зависимости от типа вопроса
document.getElementById('questionType').addEventListener('change', function() {
    const choicesSection = document.getElementById('choicesSection');
    if (this.value === 'single_choice' || this.value === 'multiple_choice') {
        choicesSection.style.display = 'block';
    } else {
        choicesSection.style.display = 'none';
    }
});

// Добавление нового поля для варианта ответа
function addChoice() {
    const container = document.getElementById('choicesContainer');
    const newChoice = document.createElement('div');
    newChoice.className = 'input-group mb-2';
    newChoice.innerHTML = `
        <input type="text" class="form-control" name="choices[]" placeholder="Введите вариант ответа">
        <button type="button" class="btn btn-outline-danger" onclick="removeChoice(this)">×</button>
    `;
    container.appendChild(newChoice);
}

// Удаление поля варианта ответа
function removeChoice(button) {
    button.parentElement.remove();
}
</script>
{% endblock %}
